<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PremierFix - Dashboard</title>
    <link rel="icon" type="image/png" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAABDVJREFUWEe9V21oXEUUPefNJtVWa6tNbIz9oRRbP8AP/FD8gB+gVhRFReyPglYqKoIIoqhYqdCKVkXEKkJVUBT8UUHxq1VQUasgVkFQqW2TxibZ3ffmHplN3u7Om7dvX7KbHFh2d+bMnXPvnTNzZ4mKxvkA7gJwIYAhAEcA7APwBYBvAUyVGaKMUQPAegD3AljVw84UgF0AngXwflE/RQFcDuBVAMeVcPoLgJcA7AHwG4C/Acw3bU8GcAqAMwBcCeBGACcWOH8dwM0AvutrAIcDeAnADQC+B/AygLcAfJvj4DgA5wG4GcDVAI4E8CKAL5JnZwF4B8AxAK4D8G5vALEEXwO4HMBzAB7KcZoO+xCAhwEcAvAAgCcT+4sAvA3gdADXAvigPwANwNUAXgPwRIGjdQAeA3AAwEYALyT25wN4A8ClAK4B8NEAAFYBeBfAEwXOHgXwIICDAO4H8FRifxGAtwBcDuAKAB8PAMByAO8BeLLA2WYA9wE4AOBJAE8n9hcDeB3AVQA2APh0AABLAbwP4OkCZ1sBbAJwEMBWAM8k9pcAeA3A9QBuAPDZAABOBLAXwDMFzrYD2AzgXwDbADyb2C8B8AqAmwDcCuDzAQAcD+ADAL0S0Q4AWwD8A+BZAC8k9ksBvAzgdgB3Aviy3wQsA/AhgOcLnO0EcA+AfwE8D+DFxH4ZgJcA3AXgbgBfDQBgKYCPALxU4OxVAHcD+BvAiwB2JfbLAbwI4B4A9wH4egAAJwD4GMArBc52A7gTwF8AdgJ4ObE/CcDzAO4H8ACAb/oBEKXgEwCvFjh7HcAdAP4E8AqA1xL7kwE8C2ArgIcBfNcPgOUAPgXwRoGzPQBuA/AHgNcBvJXYrwDwDIBHADwK4Id+AKwA8BmANwucvQngVgC/A3gLwDuJ/UoATwF4DMDjAH7sB8ApAD4H8HaBs7cB3ALgNwB7AbyX2K8C8ASAJQA+ArABwM8DAFgJ4AsA7xQ42wfgZgC/AngXwPuJ/WoA2wGcC2AUwIUAfu0HwGkAvgTwXoGz9wDcCOAXAPsB7E/s1wDYBmAjgFEApwM41A+A0wF8DWBfgbMPAFwP4GcAHwL4OLFfC+BRAJsBjAE4E8C//QA4E8A3AD4pcPYRgOsA/ATgYwCfJvZnA3gYwL0AxgGcA+D/fgCcA+BbAJ8VOPsUwDoAPwL4BMBnif15ALYC2AZgEsCFgwA4D8A3AL4qcPYlgMsA/ADgKwBfJ/YXAdgC4CEAUwAuHgTAxQAOAPiuwNk3AC4F8D2ArwB8k9hfAmATgEcATAO4bBAAlwL4AcD3Bc6+A3AJgO8AfAPg28T+MgAbATwOYAbA5YMAWAvgRwA/FTj7CcBFAH5tDvZrYn8VgHUAngIwB+DqQQD8ARVhw8em0kDrAAAAAElFTkSuQmCC">
    <meta name="theme-color" content="#ffffff">
    
    <!-- Preload critical resources -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" as="style">
    <link rel="preload" href="css/styles.css" as="style">
    
    <!-- Load fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/boxicons/2.1.4/css/boxicons.min.css" rel="stylesheet">
    
    <!-- CSS -->
    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/animations.css">
    <link rel="stylesheet" href="css/mobile-responsive.css">
    <link rel="stylesheet" href="css/branch-selector.css">

    <!-- Chart.js for data visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    
    <!-- Firebase Configuration -->
    <script>
        // Check if we're in production mode
        const isProduction = window.location.hostname === 'premierfix.uk';
    </script>
    <script src="js/firebase-config.js"></script>
    <!-- Load production config if needed -->
    <script>
        if (isProduction) {
            // Production configuration will override the development one
            document.write('<script src="js/firebase-config-prod.js"><\/script>');
        }
    </script>
    
    <!-- Core Scripts -->
    <script src="js/hotel-branch-manager.js"></script>
    
    <!-- Modern Notification System -->
    <script src="js/notifications.js"></script>
    
    <!-- Page-specific scripts -->
    <script src="js/initialize-new-database.js"></script>
    <script src="js/database-migration-checker.js"></script>
    <script src="js/hotel-config.js"></script>
    <script defer src="js/dashboard.js"></script>
    
    <style>
        :root {
            /* Refined Color Palette */
            --primary-color: #511e58; 
            --primary-light: #f3e9f7; /* Very light purple for backgrounds */
            --primary-dark: #3b1640; 
            --secondary-color: #6366F1; /* Indigo as secondary */
            --secondary-light: #e0e7ff;
            --accent-color: #F59E0B;
            --danger-color: #EF4444;
            --danger-light: #FEE2E2;
            --success-color: #10B981; 
            --success-light: #D1FAE5;
            --warning-color: #F97316;
            --warning-light: #FFEDD5;
            --light-gray: #F3F4F6; /* Lighter Gray */
            --medium-gray: #9CA3AF; /* Softer Medium Gray */
            --dark-gray: #374151; /* Slightly Softer Dark Gray */
            /* Updated Card Background */
            --card-bg-start: #ffffff;
            --card-bg-end: #fdfdff; /* Very subtle off-white */
            --card-gradient: linear-gradient(145deg, var(--card-bg-start), var(--card-bg-end));
            /* Enhanced Body Background */
            --body-bg-start: #f9fafb; /* Keep the light base */
            --body-bg-end: #f4f6f9;   /* Slightly different light tone */
            --body-gradient: linear-gradient(to bottom, var(--body-bg-start), var(--body-bg-end));
            --card-shadow: 0 3px 6px rgba(0, 0, 0, 0.04), 0 2px 4px rgba(0,0,0,0.05);
            --card-hover-shadow: 0 8px 16px rgba(0, 0, 0, 0.08);
            --control-shadow: 0 2px 5px rgba(0, 0, 0, 0.06);
            --border-color: #e5e7eb; 
            --border-radius: 10px; /* Slightly larger radius */
            --transition: all 0.25s ease-in-out;
            --font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
        }
        
        body {
            /* background-color: var(--body-bg); REMOVED */
            background: var(--body-gradient); /* Apply body gradient */
            min-height: 100vh; /* Ensure gradient covers full height */
            font-family: var(--font-family);
            color: var(--dark-gray);
            line-height: 1.5; /* Adjusted line height */
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        /* Navbar Styles - Should match index.html */
        .navbar { /* Keep as is - assuming it matches */
             background-color: var(--primary-color); 
            padding: 1rem 2rem;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            width: 100%;
            box-sizing: border-box;
        }
        .nav-content { /* Keep as is */
             width: 100%;
            max-width: 1200px; 
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }
        .nav-brand { /* Keep as is */
             display: flex;
            align-items: center;
        }
        .brand-logo { /* Keep as is */
             height: 45px;
            width: auto;
            display: block;
            max-width: 100%;
            object-fit: contain;
            margin: 0;
            padding: 0;
        }
        .nav-links { /* Keep as is */
             display: flex;
            gap: 1rem;
            align-items: center;
            flex-wrap: wrap;
        }
        .nav-links a { /* Keep as is */
             color: white;
            text-decoration: none;
            padding: 0.6rem 1.2rem;
            border-radius: 6px;
            transition: all 0.3s ease;
            font-weight: 500;
            position: relative;
            overflow: hidden;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .nav-links a:hover { /* Keep as is */
             background: rgba(255, 255, 255, 0.2);
            transform: translateY(-1px);
        }
        .nav-links a.active { /* Keep as is */
             background: rgb(52, 152, 219); 
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: none;
            font-weight: 600; 
        }
        /* End Navbar Styles */
        
        .dashboard-container {
            max-width: 1400px; /* Slightly narrower for better focus */
            margin: 2rem auto; /* Consistent margin */
            padding: 0 1.5rem;
        }
        
        .dashboard-header {
            display: flex;
            justify-content: space-between; /* Keep space between title group and any other potential items */
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 0; 
            border-bottom: none; 
        }
        
        .dashboard-title {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--dark-gray);
            margin: 0; /* Ensure no extra margin */
        }

        #refreshPageDataBtn {
             background-color: var(--primary-light);
             color: var(--primary-dark);
             border: 1px solid rgba(81, 30, 88, 0.2); /* Subtle primary border */
             padding: 0.5rem 1rem;
             border-radius: 6px;
             font-size: 0.85rem;
             font-weight: 500;
             cursor: pointer;
             transition: var(--transition);
             display: inline-flex; /* Use inline-flex */
            align-items: center;
             gap: 0.4rem;
        }
        #refreshPageDataBtn i {
             font-size: 1.1rem; /* Icon size */
        }

        #refreshPageDataBtn:hover {
             background-color: var(--primary-color);
             color: white;
             border-color: var(--primary-color);
             transform: translateY(-2px);
             box-shadow: 0 4px 8px rgba(81, 30, 88, 0.15);
        }
         #refreshPageDataBtn:active {
             transform: translateY(0px) scale(0.98);
             box-shadow: none;
         }

        .dashboard-controls {
            display: flex;
            align-items: center;
            gap: 0.75rem; 
            margin-bottom: 2rem; 
            /* background-color: var(--card-bg); REMOVED */
            background: linear-gradient(to right, #fdfdff, #f7f9fc); /* Subtle gradient for controls */
            padding: 0.75rem 1rem;
            border-radius: var(--border-radius);
            border: 1px solid var(--border-color);
            box-shadow: var(--control-shadow); /* Use dedicated shadow */
        }
        
        /* Enhanced Control Styling */
        .branch-selector select,
        .date-range-selector input {
            padding: 0.6rem 0.9rem;
            border: 1px solid var(--border-color);
            border-radius: 6px; /* Slightly smaller radius */
            background-color: var(--light-gray); /* Light background */
            font-size: 0.875rem;
            color: var(--dark-gray);
            transition: var(--transition);
            box-shadow: none;
            appearance: none; 
            min-width: 160px; 
            background-repeat: no-repeat;
            background-position: right 0.75rem center;
            background-size: 1em;
        }
        .branch-selector select {
             background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' fill='%236B7280'%3E%3Cpath fill-rule='evenodd' d='M4.22 6.22a.75.75 0 0 1 1.06 0L8 8.94l2.72-2.72a.75.75 0 1 1 1.06 1.06l-3.25 3.25a.75.75 0 0 1-1.06 0L4.22 7.28a.75.75 0 0 1 0-1.06Z' clip-rule='evenodd' /%3E%3C/svg%3E");
             padding-right: 2.25rem; 
        }
         .date-range-selector input {
             position: relative; 
             background-color: var(--light-gray);
         }
        .date-range-selector input::-webkit-calendar-picker-indicator {
             display: none;
             -webkit-appearance: none;
         }

        .branch-selector select:focus,
        .date-range-selector input:focus {
             border-color: var(--primary-color);
             outline: none;
             box-shadow: 0 0 0 2px var(--primary-light);
             background-color: var(--card-bg); /* White on focus */
        }
        
        .date-range-selector {
            display: flex;
            gap: 0.5rem; /* Reduced gap */
            margin-left: auto; /* Push date selectors to the right */
        }

        /* Enhanced Refresh Button */
        #refreshDataBtn {
            background-color: transparent; 
            border: none;
            color: var(--medium-gray);
            border-radius: 6px;
            padding: 0.5rem;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1;
        }
        #refreshDataBtn i {
            font-size: 1.35rem; /* Slightly larger */
        }
        #refreshDataBtn:hover {
             background-color: var(--light-gray);
             color: var(--primary-color);
        }
        #refreshDataBtn:active {
             transform: scale(0.95);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); /* Adjusted minmax */
            gap: 1.25rem; /* Slightly reduced gap */
            margin-bottom: 2rem;
        }
        
        /* More Modern Stat Card */
        .stat-card {
            /* background: var(--card-bg); REMOVED - using gradient now */
            background: var(--card-gradient);
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow); /* Apply base shadow */
            padding: 1.5rem; /* Increased padding */
            transition: var(--transition);
            border: 1px solid var(--border-color); /* Keep border */
            display: flex;
            flex-direction: column;
            position: relative; 
            overflow: hidden;
        }
        
        .stat-card:hover {
            transform: translateY(-5px) scale(1.01); /* More lift and slight scale */
            box-shadow: var(--card-hover-shadow);
            border-color: var(--primary-light);
        }
        
        .stat-header {
             display: flex;
             justify-content: space-between;
             align-items: center; /* Align title and icon vertically */
             margin-bottom: 0.75rem; /* Increased margin */
        }

        .stat-title {
            font-size: 0.875rem; 
            font-weight: 500;
            color: var(--medium-gray);
            margin: 0;
        }
        
        .stat-icon {
             font-size: 1.2rem; 
             padding: 0.5rem;
             border-radius: 6px; /* Smaller radius */
             display: inline-flex;
             align-items: center;
             justify-content: center;
             flex-shrink: 0;
             /* Removed margin-left */
        }
        /* Icon Colors - Adjusted for better contrast/modern feel */
        .icon-branches { background-color: var(--primary-light); color: var(--primary-dark); }
        .icon-rooms { background-color: var(--secondary-light); color: var(--secondary-color); }
        .icon-issues { background-color: var(--warning-light); color: var(--warning-color); }
        .icon-rate { background-color: var(--success-light); color: var(--success-color); }

        .stat-value {
            font-size: 2.25rem; /* Larger value */
            font-weight: 600; 
            margin: 0.25rem 0 0.5rem 0; 
            color: var(--dark-gray);
            line-height: 1.1;
            flex-grow: 1; 
        }

        /* Removed stat-change container */

        .charts-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); /* Responsive columns */
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .chart-card, .activity-card, .time-distribution-card {
            /* background: var(--card-bg); REMOVED - using gradient */
            background: var(--card-gradient);
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
            padding: 1.75rem; /* Slightly more padding */
            border: 1px solid var(--border-color);
            transition: var(--transition);
        }
        
        .chart-card:hover, .activity-card:hover, .time-distribution-card:hover {
             transform: translateY(-4px);
             box-shadow: var(--card-hover-shadow);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem; /* Increased margin */
            padding-bottom: 0; /* Remove padding */
            border-bottom: none; /* Remove bottom border */
        }

        .card-title {
            font-size: 1.1rem; /* Increased title size */
            font-weight: 600;
            margin: 0;
             color: var(--dark-gray);
        }

        .chart-container {
            position: relative;
            height: 300px; /* Reduced default height slightly */
        }
        
        .activity-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); /* Match charts-row */
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .activity-list {
            max-height: 300px; /* Adjusted max height */
            overflow-y: auto;
            padding-right: 0.5rem;
        }
        
        /* Minimalist Scrollbar */
        .activity-list::-webkit-scrollbar {
            width: 4px;
        }
        .activity-list::-webkit-scrollbar-thumb {
            background: #d1d5db; /* Lighter thumb */
            border-radius: 2px;
        }
        .activity-list::-webkit-scrollbar-thumb:hover {
            background: var(--medium-gray);
        }

        .activity-item {
            display: flex;
            align-items: center; /* Vertically align icon and text */
            padding: 0.8rem 0.25rem; 
            border-bottom: 1px solid var(--border-color);
            transition: background-color 0.15s;
        }
        .activity-item:hover {
             background-color: var(--light-gray);
             border-radius: 4px; 
        }
        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-icon {
            width: 30px; 
            height: 30px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 0.85rem; 
            flex-shrink: 0;
            font-size: 1rem; 
        }
        /* Activity Icon Colors - UPDATED */
        .activity-icon.new { background-color: var(--primary-light); color: var(--primary-dark); }
        .activity-icon.progress { background-color: var(--warning-light); color: var(--warning-color); }
        /* Removed completed style as it's filtered out */
        /* .activity-icon.completed { background-color: var(--success-light); color: var(--success-color); } */
        .activity-icon.critical { background-color: var(--danger-light); color: var(--danger-color); } 
        /* Removed error style as critical takes precedence for display */
        /* .activity-icon.error { background-color: var(--danger-light); color: var(--danger-color); } */

        .activity-content {
            flex: 1;
            /* Removed fixed height if any */
        }

        /* NEW styles for activity content structure */
        .activity-branch {
            font-size: 0.95rem;
            font-weight: 600;
            color: var(--dark-gray);
            margin: 0 0 0.25rem 0;
        }
        .activity-details {
            font-size: 0.8rem;
            color: var(--medium-gray);
            margin: 0 0 0.3rem 0;
            display: flex;
            flex-wrap: wrap;
            gap: 0.3rem 0.75rem; /* Row and column gap */
        }
        .activity-details span strong {
            color: var(--dark-gray);
            font-weight: 500;
        }

        /* NEW: Wrapper for description and photo */
        .activity-description-photo-wrapper {
            display: flex;
            align-items: flex-start; /* Align items to the top */
            justify-content: space-between; /* Distribute space */
            gap: 0.75rem; /* Maintain gap if space allows */
            margin-bottom: 0.25rem; /* Space below this wrapper */
        }

        .activity-text {
            margin: 0; /* Reset margin */
            font-size: 0.85rem; 
            font-weight: 600; /* Bolder weight */
            color: var(--dark-gray);
            line-height: 1.4;
            /* flex-grow: 1; REMOVED - Let text take natural width */
        }

        .activity-time {
            margin: 0.25rem 0 0 0; /* Added top margin */
            font-size: 0.75rem; 
            color: var(--medium-gray);
        }
        .critical-flag {
            color: var(--danger-color);
            font-weight: 600;
        }
        
        .time-distribution-card {
            /* Remove grid-column span to let it fit naturally */
        }
        .time-distribution-container {
            position: relative;
            height: 250px;
        }

        /* Loading Indicator remains the same */
        .loading-container { /* ... */ }
        .loading-spinner { /* ... */ }
        @keyframes spin { /* ... */ }
        
        /* Responsive Adjustments */
        @media (max-width: 1200px) {
            /* Keep single column layout from previous rule */
        }
        
        @media (max-width: 768px) {
             .dashboard-container {
                 padding: 0 1rem;
             }
            .dashboard-header {
                /* Keep column layout */
            }
            .dashboard-title {
                font-size: 1.5rem; /* Restore size slightly */
            }
            .dashboard-controls {
                flex-direction: column;
                align-items: stretch;
                padding: 0.75rem;
                gap: 0.75rem; 
            }
            .date-range-selector {
                 margin-left: 0; /* Stack controls vertically */
             }
             #refreshDataBtn {
                 align-self: flex-end; /* Button to the right */
            }

            .stats-grid {
                 grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); 
                 gap: 1rem;
            }
            .stat-card {
                 padding: 1rem;
            }
            .stat-value {
                 font-size: 1.75rem;
            }

            .chart-card, .activity-card, .time-distribution-card {
                 padding: 1rem;
            }
            .card-header {
                 padding-bottom: 0.75rem;
                 margin-bottom: 1rem;
            }
            .card-title {
                 font-size: 1rem;
            }
            .chart-container, .time-distribution-container {
                 height: 220px; /* Further reduce height */
            }
             .activity-list {
                 max-height: 250px;
             }
        }
         @media (max-width: 576px) {
             .stats-grid {
                 grid-template-columns: 1fr 1fr; 
             }
              .dashboard-controls {
                 padding: 0.5rem;
             }
              .branch-selector select,
              .date-range-selector input {
                  padding: 0.6rem 0.75rem;
                  font-size: 0.85rem;
              }
              #refreshDataBtn {
                  padding: 0.4rem;
              }
              #refreshDataBtn i {
                  font-size: 1.1rem;
              }
         }

        .activity-item-link {
             display: block; /* Make the link take full width */
             text-decoration: none; /* Remove underline from link */
             color: inherit; /* Inherit text color */
             border-radius: 4px; /* Match item hover radius */
             transition: background-color 0.15s;
        }
        .activity-item-link:hover {
             /* Apply hover effect to the link wrapper */
             background-color: var(--light-gray);
        }
        .activity-item-link:hover .activity-item {
             border-bottom-color: transparent; /* Hide border on hover if needed */
        }
        /* Ensure the item itself doesn't have hover style if link handles it */
        /* .activity-item:hover { background-color: transparent; } */

        .activity-photo-preview {
             max-width: 120px; /* Limit preview size - Doubled from 60px */
             max-height: 80px; /* Limit preview size - Doubled from 40px */
             border-radius: 4px;
             margin-top: 0; /* Reset margin-top */
             /* margin-left: auto; REMOVED - Let justify-content handle positioning */
             flex-shrink: 0; /* Prevent photo from shrinking */
             object-fit: cover; /* Cover the area */
             border: 1px solid var(--border-color);
             background-color: var(--light-gray); /* Keep for debugging */
        }

        /* OLD ACTIVITY STYLES - REMOVE/COMMENT OUT */
        /*
        .activity-item {
            display: flex;
            align-items: center; 
            padding: 0.8rem 0.25rem; 
            border-bottom: 1px solid var(--border-color);
            transition: background-color 0.15s;
        }
        .activity-item:hover {
             background-color: var(--light-gray);
             border-radius: 4px; 
        }
        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-icon {
            width: 30px; 
            height: 30px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 0.85rem; 
            flex-shrink: 0;
            font-size: 1rem; 
        }
        .activity-icon.new { background-color: var(--primary-light); color: var(--primary-dark); }
        .activity-icon.progress { background-color: var(--warning-light); color: var(--warning-color); }
        .activity-icon.critical { background-color: var(--danger-light); color: var(--danger-color); } 

        .activity-content {
            flex: 1;
        }

        .activity-branch {
            font-size: 0.95rem;
            font-weight: 600;
            color: var(--dark-gray);
            margin: 0 0 0.25rem 0;
        }
        .activity-details {
            font-size: 0.8rem;
            color: var(--medium-gray);
            margin: 0 0 0.3rem 0;
            display: flex;
            flex-wrap: wrap;
            gap: 0.3rem 0.75rem; 
        }
        .activity-details span strong {
            color: var(--dark-gray);
            font-weight: 500;
        }

        .activity-description-photo-wrapper {
            display: flex;
            align-items: flex-start; 
            justify-content: space-between; 
            gap: 0.75rem; 
            margin-bottom: 0.25rem; 
        }

        .activity-text {
            margin: 0; 
            font-size: 0.85rem; 
            font-weight: 600; 
            color: var(--dark-gray);
            line-height: 1.4;
        }

        .activity-time {
            margin: 0.25rem 0 0 0; 
            font-size: 0.75rem; 
            color: var(--medium-gray);
        }
        .critical-flag {
            color: var(--danger-color);
            font-weight: 600;
        }
        
        .activity-photo-preview {
             max-width: 120px; 
             max-height: 80px; 
             border-radius: 4px;
             margin-top: 0; 
             flex-shrink: 0; 
             object-fit: cover; 
             border: 1px solid var(--border-color);
             background-color: var(--light-gray); 
        }
        */
        /* END OLD ACTIVITY STYLES */

        /* --- NEW GRID LAYOUT FOR ACTIVITY ITEMS --- */
        .activity-item-grid-parent {
            display: grid;
            grid-template-columns: 50px repeat(4, 1fr); /* Icon column + 4 content columns */
            grid-template-rows: auto auto 1fr; /* Adjust row sizing: Header, Description, Footer */
            gap: 5px 10px; /* Row gap, Column gap */
            padding: 0.8rem 0.25rem;
            border-bottom: 1px solid var(--border-color);
            min-height: 100px; /* Minimum height for the item */
        }
        .activity-item-link:last-child .activity-item-grid-parent {
             border-bottom: none; /* Remove border for last item */
         }

        /* Assign grid areas based on the layout */
        .div1 { grid-area: 1 / 2 / 2 / 3; font-weight: 600; } /* Branch Name */
        .div2 { grid-area: 1 / 3 / 2 / 4; font-size: 0.9em; color: var(--medium-gray);} /* Room/Location */
        .div3 { grid-area: 1 / 4 / 2 / 5; font-size: 0.9em; color: var(--medium-gray); text-align: right;} /* Category */
        .div4 { 
            grid-area: 1 / 5 / 4 / 6; /* Image spans all rows */
            display: flex; /* Use flex to center placeholder/image */
            align-items: center; 
            justify-content: center; 
            overflow: hidden; /* Hide overflow */
            background-color: var(--light-gray); /* BG for placeholder */
            border-radius: 4px;
            border: 1px solid var(--border-color);
        }
        .div5 { 
            grid-area: 2 / 2 / 3 / 5; /* Description spans columns 2-4 */ 
            font-size: 0.85rem; 
            font-weight: 500; 
            color: var(--dark-gray);
            line-height: 1.4;
            padding-top: 5px; /* Add some space above description */
        }
        .div6 { 
            grid-area: 3 / 2 / 4 / 4; /* Date/Time spans columns 2-3 */
            font-size: 0.75rem; 
            color: var(--medium-gray);
            align-self: end; /* Align to bottom */
        }
        .div7 { 
            grid-area: 3 / 4 / 4 / 5; /* Issue Type in last column */
            font-size: 0.75rem; 
            font-weight: 600;
            text-align: right;
            align-self: end; /* Align to bottom */
        }
        .div7.critical-text { color: var(--danger-color); }

        .div8 { 
            grid-area: 1 / 1 / 4 / 2; /* Icon spans all rows */
            display: flex; 
            align-items: center; 
            justify-content: center; 
        }
        
        /* Styling for image within div4 */
        .activity-photo-preview-grid {
            width: 100%;
            height: 100%;
            object-fit: cover; /* Cover the area */
            border-radius: 4px; /* Match parent div border radius */
        }
        .activity-image-placeholder::after { /* Style for placeholder */
            content: "No Img";
            color: var(--medium-gray);
            font-size: 0.8rem;
        }

        /* Icon styling (reuse existing classes if applicable, or use new ones) */
        .activity-icon-grid {
            width: 36px; 
            height: 36px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem; 
            flex-shrink: 0;
            margin: auto 0; /* Center vertically */
        }
        .activity-icon-grid.new { background-color: var(--primary-light); color: var(--primary-dark); }
        .activity-icon-grid.progress { background-color: var(--warning-light); color: var(--warning-color); }
        .activity-icon-grid.critical { background-color: var(--danger-light); color: var(--danger-color); }
        /* --- END NEW GRID LAYOUT --- */

        .time-distribution-card {
            /* Remove grid-column span to let it fit naturally */
        }
        .time-distribution-container {
            position: relative;
            height: 250px;
         }
    </style>
</head>
<body>
    <!-- Navbar (Should be correct now) -->
    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-brand">
                <img src="images/PremierFix.png" alt="PremierFix Logo" class="brand-logo" onerror="this.style.display='none'; this.parentElement.innerHTML='PremierFix';">
            </div>
            <div class="nav-links">
                <a href="index.html">Log Issue</a>
                <a href="tracking-new.html">Track Issues</a>
                <a href="dashboard.html" class="active">Dashboard</a>
                <a href="hoteleditor.html">Hotel Editor</a>
            </div>
        </div>
    </nav>

    <!-- Loading indicator -->
    <div class="loading-container active" id="loadingContainer">
        <div class="loading-spinner"></div>
    </div>

    <div class="dashboard-container">
        <div class="dashboard-header">
            <h1 class="dashboard-title">Performance Overview</h1>
            <button id="refreshPageDataBtn">
                <i class='bx bx-refresh'></i> Refresh Data
            </button>
        </div>

        <!-- Controls Bar -->
        <div class="dashboard-controls">
            <div class="branch-selector">
                <select id="branchSelect" aria-label="Select Hotel Branch">
                    <option value="all">All Branches</option>
                    <!-- Options populated by JS -->
                </select>
            </div>
            <div class="date-range-selector">
                <input type="date" id="startDate" aria-label="Start Date">
                <input type="date" id="endDate" aria-label="End Date">
            </div>
        </div>

        <!-- Stats Grid (Markup remains same, styling updated) -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-header">
                    <h3 class="stat-title">Total Branches</h3>
                    <span class="stat-icon icon-branches"><i class='bx bxs-buildings'></i></span>
                </div>
                <p class="stat-value" id="totalBranches">-</p>
            </div>
            <div class="stat-card">
                 <div class="stat-header">
                    <h3 class="stat-title">Total Rooms</h3>
                     <span class="stat-icon icon-rooms"><i class='bx bxs-hotel'></i></span>
                </div>
                <p class="stat-value" id="totalRooms">-</p>
            </div>
            <div class="stat-card">
                 <div class="stat-header">
                    <h3 class="stat-title">Active Issues</h3>
                     <span class="stat-icon icon-issues"><i class='bx bxs-error-alt'></i></span>
                </div>
                <p class="stat-value" id="activeIssues">-</p>
            </div>
            <div class="stat-card">
                 <div class="stat-header">
                    <h3 class="stat-title">Resolution Rate</h3>
                     <span class="stat-icon icon-rate"><i class='bx bxs-check-shield'></i></span>
                </div>
                <p class="stat-value" id="resolutionRate">-%</p>
            </div>
        </div>

        <!-- Charts Row (Markup remains same) -->
        <div class="charts-row">
            <div class="chart-card">
                <div class="card-header">
                    <h3 class="card-title">Issue Volume Trends</h3>
                </div>
                <div class="chart-container">
                    <canvas id="issuesTrendChart"></canvas>
                </div>
            </div>
            <div class="chart-card">
                <div class="card-header">
                    <h3 class="card-title">Issues by Category</h3>
                </div>
                <div class="chart-container">
                    <canvas id="categoriesChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Activity Grid (Markup remains same) -->
        <div class="activity-grid">
             <div class="activity-card">
                <div class="card-header">
                    <h3 class="card-title">Recent Activity Feed</h3>
                </div>
                <div class="activity-list" id="recentActivities">
                    <p style="text-align: center; padding: 1rem; color: var(--medium-gray);">Loading activities...</p> 
                </div>
            </div>
             <div class="chart-card">
                <div class="card-header">
                    <h3 class="card-title">Current Issue Status</h3>
                </div>
                <div class="chart-container">
                    <canvas id="statusChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Time Distribution (Markup remains same) -->
        <div class="time-distribution-card">
            <div class="card-header">
                <h3 class="card-title">Issue Resolution Time (by Hour Completed)</h3>
            </div>
            <div class="time-distribution-container">
                <canvas id="timeDistributionChart"></canvas>
            </div>
        </div>
    </div>

    <!-- Footer (Markup remains same) -->
    <footer>
        <p style="text-align: center; margin-top: 2rem; font-size: 0.85rem; color: var(--medium-gray);">
            &copy; 2024 PremierFix. All rights reserved.
        </p>
    </footer>

    <!-- Script section remains the same -->
    <script>
        function showLoading() {
            const loadingContainer = document.getElementById('loadingContainer');
            if (loadingContainer) {
                loadingContainer.classList.add('active');
            }
        }

        function hideLoading() {
            setTimeout(() => {
                const loadingContainer = document.getElementById('loadingContainer');
                if (loadingContainer) {
                    loadingContainer.classList.remove('active');
                }
            }, 300);
        }

        document.addEventListener('DOMContentLoaded', function() {
            const refreshButton = document.getElementById('refreshPageDataBtn');
            if(refreshButton) {
                refreshButton.addEventListener('click', () => {
                      console.log('Refresh button clicked - implement data refresh logic in dashboard.js');
                      showLoading();
                 });
            }
            
            const logoutButton = document.getElementById('logoutButton');
            if(logoutButton) {
                  logoutButton.addEventListener('click', () => {
                       console.log('Logout clicked - implement logout');
                  });
             }
             
            const userDisplay = document.getElementById('userDisplayName');
            if(userDisplay) {
                  userDisplay.textContent = 'Manager Name';
             }
        });
    </script>
</body>
</html> 