<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PremierFix - Room Audit</title>
    <link rel="icon" type="image/png" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAABDVJREFUWEe9V21oXEUUPefNJtVWa6tNbIz9oRRbP8AP/FD8gB+gVhRFReyPglYqKoIIoqhYqdCKVkXEKkJVUBT8UUHxq1VQUasgVkFQqW2TxibZ3ffmHplN3u7Om7dvX7KbHFh2d+bMnXPvnTNzZ4mKxvkA7gJwIYAhAEcA7APwBYBvAUyVGaKMUQPAegD3AljVw84UgF0AngXwflE/RQFcDuBVAMeVcPoLgJcA7AHwG4C/Acw3bU8GcAqAMwBcCeBGACcWOH8dwM0AvutrAIcDeAnADQC+B/AygLcAfJvj4DgA5wG4GcDVAI4E8CKAL5JnZwF4B8AxAK4D8G5vALEEXwO4HMBzAB7KcZoO+xCAhwEcAvAAgCcT+4sAvA3gdADXAvigPwANwNUAXgPwRIGjdQAeA3AAwEYALyT25wN4A8ClAK4B8NEAAFYBeBfAEwXOHgXwIICDAO4H8FRifxGAtwBcDuAKAB8PAMByAO8BeLLA2WYA9wE4AOBJAE8n9hcDeB3AVQA2APh0AABLAbwP4OkCZ1sBbAJwEMBWAM8k9pcAeA3A9QBuAPDZAABOBLAXwDMFzrYD2AzgXwDbADyb2C8B8AqAmwDcCuDzAQAcD+ADAL0S0Q4AWwD8A+BZAC8k9ksBvAzgdgB3Aviy3wQsA/AhgOcLnO0EcA+AfwE8D+DFxH4ZgJcA3AXgbgBfDQBgKYCPALxU4OxVAHcD+BvAiwB2JfbLAbwI4B4A9wH4egAAJwD4GMArBc52A7gTwF8AdgJ4ObE/CcDzAO4H8ACAb/oBEKXgEwCvFjh7HcAdAP4E8AqA1xL7kwE8C2ArgIcBfNcPgOUAPgXwRoGzPQBuA/AHgNcBvJXYrwDwDIBHADwK4Id+AKwA8BmANwucvQngVgC/A3gLwDuJ/UoATwF4DMDjAH7sB8ApAD4H8HaBs7cB3ALgNwB7AbyX2K8C8ASAJQA+ArABwM8DAFgJ4AsA7xQ42wfgZgC/AngXwPuJ/WoA2wGcC2AUwIUAfu0HwGkAvgTwXoGz9wDcCOAXAPsB7E/s1wDYBmAjgFEApwM41A+A0wF8DWBfgbMPAFwP4GcAHwL4OLFfC+BRAJsBjAE4E8C//QA4E8A3AD4pcPYRgOsA/ATgYwCfJvZnA3gYwL0AxgGcA+D/fgCcA+BbAJ8VOPsUwDoAPwL4BMBnif06AA8BmAAwAeD8QQCcB+A7AF8UOPscwFoAPwD4HMCXif35ALYC2AZgEsCFgwC4AMD3AL4qcPYlgMsA/ADgKwBfJ/YXAdgC4CEAUwAuHgTAxQAOAPiuwNk3AC4F8D2ArwB8k9hfAmATgEcATAO4bBAAlwL4AcD3Bc6+A3AJgO8AfAPg28T+MgAbATwOYAbA5YMAWAPgRwA/FTj7HsDFAA4A+BHAwcT+CgDrATwJYBbA5YMAWAvgZwC/FDj7CcBFAH5tDvZrYn8VgHUAngIwB+DqQQD8ARVhw8em0kDrAAAAAElFTkSuQmCC">
    <meta name="theme-color" content="#3a7bd5">
    
    <!-- Preload critical resources -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" as="style">
    <link rel="preload" href="css/styles.css" as="style">
    
    <!-- Load fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Critical CSS -->
    <style>
        :root {
            --primary-color: #3a7bd5;
            --secondary-color: #3498db;
            --background-color: #f5f6fa;
            --text-color: #2c3e50;
            --border-color: #dcdde1;
            --success-color: #4ade80;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --glass-bg: rgba(255, 255, 255, 0.7);
            --glass-border: rgba(255, 255, 255, 0.2);
            --glass-shadow: rgba(31, 38, 135, 0.15);
        }
        body {
            background-color: var(--background-color);
            color: var(--text-color);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
        }
        .container {
            max-width: 900px;
            margin: 2rem auto;
            padding: 0 1rem;
            flex: 1;
            width: 100%;
        }
        
        /* Loading Indicator */
        .loading-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }

        .loading-container.active {
            opacity: 1;
            visibility: visible;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(58, 123, 213, 0.2);
            border-radius: 50%;
            border-top-color: #3a7bd5;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
        
        /* Audit Checklist Styles */
        .audit-header {
            margin-bottom: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1.5rem;
        }
        
        .audit-header-content {
            text-align: left;
            flex: 1;
            min-width: 300px;
        }
        
        .audit-header h1 {
            color: var(--primary-color);
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;
            font-size: 2.2rem;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, #3a7bd5 0%, #00d2ff 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-align: left;
        }
        
        .audit-header p {
            margin-top: 0;
            font-size: 1.1rem;
        }
        
        .branch-display {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            min-width: 250px;
            max-width: 300px;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
            flex-shrink: 0;
            border-left: 4px solid #3a7bd5;
        }
        
        .branch-display::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100%;
            height: 6px;
            background: linear-gradient(135deg, #3a7bd5 0%, #00d2ff 100%);
        }
        
        .branch-display:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }
        
        .branch-display h3 {
            margin-top: 0;
            margin-bottom: 1rem;
            font-weight: 600;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-color);
        }
        
        .branch-display h3 svg {
            color: #3a7bd5;
        }
        
        .branch-name {
            font-size: 1.4rem;
            font-weight: 700;
            color: #3a7bd5;
            margin: 0;
            word-break: break-word;
        }
        
        .branch-address {
            margin: 0.5rem 0 0;
            font-size: 0.95rem;
            color: #64748b;
        }
        
        .branch-select-container {
            margin-top: 1rem;
            padding-top: 0.5rem;
            border-top: 1px dashed #e2e8f0;
        }
        
        .branch-select-label {
            display: block;
            font-size: 0.9rem;
            color: #64748b;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }
        
        .branch-select {
            width: 100%;
            padding: 0.6rem 0.8rem;
            border-radius: 6px;
            border: 2px solid var(--border-color);
            background-color: white;
            font-size: 0.95rem;
            color: var(--text-color);
            cursor: pointer;
            transition: all 0.3s ease;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%233a7bd5' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 0.8rem center;
            background-size: 1em;
            padding-right: 2.5rem;
        }
        
        .branch-select:hover {
            border-color: #3a7bd5;
        }
        
        .branch-select:focus {
            outline: none;
            border-color: #3a7bd5;
            box-shadow: 0 0 0 3px rgba(58, 123, 213, 0.1);
        }
        
        .branch-status {
            display: flex;
            align-items: center;
            margin-top: 1rem;
            gap: 0.5rem;
            padding-top: 0.5rem;
            border-top: 1px dashed #e2e8f0;
            justify-content: space-between;
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
        }
        
        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: #10b981;
            display: inline-block;
            margin-right: 0.5rem;
            position: relative;
        }
        
        .status-dot::after {
            content: '';
            position: absolute;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: #10b981;
            opacity: 0.5;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% {
                transform: scale(1);
                opacity: 0.5;
            }
            70% {
                transform: scale(1.5);
                opacity: 0;
            }
            100% {
                transform: scale(1.5);
                opacity: 0;
            }
        }
        
        .refresh-btn {
            background: none;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #64748b;
            transition: all 0.2s;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            padding: 0;
        }
        
        .refresh-btn:hover {
            color: var(--primary-color);
            background-color: rgba(58, 123, 213, 0.1);
        }
        
        .refresh-btn svg {
            width: 16px;
            height: 16px;
        }
        
        @keyframes spin-animation {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }
        
        .refresh-btn.spinning svg {
            animation: spin-animation 1s linear infinite;
        }
        
        .status-text {
            font-size: 0.9rem;
            font-weight: 500;
            color: #64748b;
        }
        
        @media (max-width: 768px) {
            .audit-header {
                flex-direction: column;
                align-items: stretch;
            }
            
            .branch-display {
                max-width: 100%;
            }
            
            .audit-header-content {
                text-align: center;
            }
            
            .audit-header h1 {
                text-align: center;
                font-size: 1.8rem;
            }
        }
        
        .audit-content {
            display: grid;
            gap: 2rem;
            grid-template-columns: 1fr;
        }
        
        .room-input-container {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 2rem;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .room-input-container:focus-within {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }
        
        .room-input-container label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
            color: var(--text-color);
        }
        
        .room-input-container input {
            width: 100%;
            padding: 0.75rem 1rem;
            font-size: 1.1rem;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            outline: none;
            transition: all 0.3s;
        }
        
        .room-input-container input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(58, 123, 213, 0.1);
        }
        
        .checklist-container {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 0;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .checklist-container:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }
        
        .checklist-header {
            background: linear-gradient(135deg, #3a7bd5 0%, #00d2ff 100%);
            color: white;
            padding: 1.25rem 1.5rem;
        }
        
        .checklist-header h2 {
            margin: 0;
            font-family: 'Montserrat', sans-serif;
            font-weight: 600;
            font-size: 1.5rem;
        }
        
        .checklist-items {
            padding: 1.5rem;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
        
        .checklist-item {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
            padding: 0.5rem;
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.2s ease;
        }
        
        .checklist-item:hover {
            background-color: rgba(58, 123, 213, 0.05);
            transform: translateX(3px);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }
        
        .checklist-item:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }
        
        .checklist-item label {
            flex: 1;
            display: flex;
            align-items: center;
            font-weight: 500;
            margin-left: 0.75rem;
            cursor: pointer;
            user-select: none;
            z-index: 1;
        }
        
        .checkbox-wrapper {
            display: flex;
            align-items: center;
            position: relative;
            z-index: 0;
        }
        
        .checkbox-wrapper input[type="checkbox"] {
            opacity: 0;
            position: absolute;
            width: 22px;
            height: 22px;
            margin: 0;
            cursor: pointer;
            z-index: 2;
        }
        
        .checkbox-wrapper .checkbox-custom {
            width: 22px;
            height: 22px;
            border: 2px solid var(--border-color);
            border-radius: 4px;
            position: relative;
            cursor: pointer;
            transition: all 0.2s;
            pointer-events: none;
        }
        
        .checkbox-wrapper input[type="checkbox"]:checked + .checkbox-custom {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        .checkbox-wrapper input[type="checkbox"]:checked + .checkbox-custom::after {
            content: '';
            position: absolute;
            left: 6px;
            top: 2px;
            width: 6px;
            height: 11px;
            border: solid white;
            border-width: 0 2px 2px 0;
            transform: rotate(45deg);
        }
        
        /* Mobile responsive adjustments */
        @media (max-width: 768px) {
            .checklist-items {
                grid-template-columns: 1fr;
            }
            
            .audit-header h1 {
                font-size: 1.8rem;
            }
        }
        
        .notes-container {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 2rem;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .notes-container:focus-within {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }
        
        .notes-header {
            background: linear-gradient(135deg, #3a7bd5 0%, #00d2ff 100%);
            color: white;
            padding: 1.25rem 1.5rem;
        }
        
        .notes-header h2 {
            margin: 0;
            font-family: 'Montserrat', sans-serif;
            font-weight: 600;
            font-size: 1.5rem;
        }
        
        .notes-content {
            padding: 1.5rem;
        }
        
        .notes-content textarea {
            width: 100%;
            min-height: 120px;
            padding: 0.75rem 1rem;
            font-size: 1rem;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            outline: none;
            transition: all 0.3s;
            resize: vertical;
            font-family: inherit;
        }
        
        .notes-content textarea:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(58, 123, 213, 0.1);
        }
        
        .action-buttons {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        @media (min-width: 576px) {
            .action-buttons {
                flex-direction: row;
            }
        }
        
        .action-button {
            padding: 1rem 1.5rem;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            flex: 1;
            border: none;
            outline: none;
        }
        
        .upload-button {
            background-color: #6c5ce7;
            color: white;
        }
        
        .upload-button:hover {
            background-color: #5649cf;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(108, 92, 231, 0.2);
        }
        
        .submit-button {
            background: linear-gradient(135deg, #3a7bd5 0%, #00d2ff 100%);
            color: white;
        }
        
        .submit-button:hover {
            background: linear-gradient(135deg, #3a7bd5 0%, #00d2ff 100%);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(58, 123, 213, 0.2);
        }
        
        /* Responsive navbar styles */
        .navbar {
            background-color: #3a7bd5;
            padding: 1rem 2rem;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            text-align: center;
            margin-bottom: 1.5rem;
            width: 100%;
            box-sizing: border-box;
        }
        
        .nav-content {
            width: 100%;
            max-width: 1200px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .nav-brand {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        
        .brand-logo {
            height: 45px;
            width: auto;
            display: block;
            max-width: 100%;
            object-fit: contain;
            margin: 0;
            padding: 0;
        }
        
        .nav-links {
            display: flex;
            gap: 1rem;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .nav-links a {
            color: white;
            text-decoration: none;
            padding: 0.6rem 1.2rem;
            border-radius: 6px;
            transition: all 0.3s ease;
            font-weight: 500;
            position: relative;
            overflow: hidden;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .nav-links a:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .nav-links a.active {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        /* Notification styles in case they're not defined elsewhere */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            background-color: white;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            transition: all 0.3s ease;
            opacity: 0;
            transform: translateY(-20px);
            max-width: 300px;
        }
        
        .notification.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        .notification.success {
            border-left: 4px solid #4ade80;
        }
        
        .notification.error {
            border-left: 4px solid #ef4444;
        }
        
        .notification-content {
            display: flex;
            align-items: center;
        }
        
        .notification-content span {
            font-size: 0.95rem;
            color: var(--text-color);
        }

        /* Preview Image Container */
        .image-preview-container {
            display: none;
            margin-top: 1rem;
            text-align: center;
        }

        .image-preview-container img {
            max-width: 100%;
            max-height: 300px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        /* Add styles for the modal */
        .modal {
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }
        
        .modal.show {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-content {
            background-color: white;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            max-height: 90vh;
            overflow-y: auto;
        }

        /* New styles for the branch selector */
        .branch-info-selector {
            background-color: #ffffff;
            padding: 15px 20px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            border: 1px solid var(--border-color);
            min-width: 300px;
            max-width: 450px;
            flex-shrink: 0;
            position: relative;
            z-index: 5;
            margin-top: 1.5rem;
        }

        .branch-info-selector p#branchNameDisplay {
            font-weight: 600;
            color: var(--primary-color);
            margin-top: 0;
            margin-bottom: 10px;
            font-size: 0.95rem;
            border-bottom: 1px dashed var(--border-color);
            padding-bottom: 8px;
        }

        /* Container for Choices.js element */
        .branch-selector-choices-container {
            position: relative;
            z-index: 10;
        }

        /* Override Choices.js width inside this container */
        .branch-info-selector .choices {
             width: 100%;
             margin-bottom: 0;
        }

        /* Custom Choices.js Styling */
        .choices__inner {
            background-color: white;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            padding: 7px 12px;
            font-size: 1rem;
            min-height: auto;
            transition: border-color 0.2s ease;
        }
        .is-focused .choices__inner, .is-open .choices__inner {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(58, 123, 213, 0.1);
        }
        .choices__list--dropdown {
            border-radius: 8px;
            border: 1px solid rgba(0,0,0,0.2);
            margin-top: 5px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            z-index: 50;
            background-color: white;
            color: var(--text-color);
        }
        .choices__list--dropdown .choices__item--selectable.is-highlighted {
            background-color: rgba(58, 123, 213, 0.1);
            color: var(--primary-color);
        }
        .choices__list--dropdown .choices__item--selectable:hover {
            background-color: rgba(58, 123, 213, 0.05);
        }
        .choices__placeholder {
            color: #6c757d;
            opacity: 1;
        }
        .choices__input {
             padding: 0;
             background-color: transparent;
             color: inherit;
        }

        /* Visually hidden class for accessibility */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }
    </style>

    <!-- Consolidated Stylesheets -->
    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/room-audit.css">
    <link rel="stylesheet" href="css/notifications.css">
    <link rel="stylesheet" href="css/animations.css">
    <link rel="stylesheet" href="css/responsive.css">
    <link rel="stylesheet" href="css/dark-mode.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <!-- Choices.js CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css"/>

    <!-- Firebase SDK (v8) -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>

    <!-- Core Config and Managers -->
    <script src="js/firebase-config.js"></script>
    <script src="js/hotel-config.js"></script> 
    <script src="js/hotel-branch-manager.js"></script>
    <script src="js/notifications.js"></script>

    <!-- Page-specific logic -->
    <script src="js/room-audit.js" defer></script> 
</head>
<body>
    <!-- Loading indicator -->
    <div class="loading-container" id="loadingContainer">
        <div class="loading-spinner"></div>
    </div>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-brand">
                <img src="images/PremierFix.png" alt="PremierFix Logo" class="brand-logo" onerror="this.style.display='none'; this.parentElement.innerHTML='PremierFix';">
            </div>
            <div class="nav-links">
                <a href="index.html">Log Issue</a>
                <a href="tracking-new.html">Track Issues</a>
                <a href="room-audit.html" class="active">Room Audit</a>
                <a href="audit-logs.html">Audit Logs</a>
            </div>
        </div>
    </nav>

    <div class="container">
        <div class="audit-header">
            <div class="audit-header-content">
                <h1>Room Audit Process</h1>
                <p>Complete the checklist below to audit a room in this branch.</p>
            </div>
            <!-- Updated Branch Display -->
            <div class="branch-info-selector">
                <p id="branchNameDisplay">Loading branch information...</p>
                <div class="branch-selector-choices-container"> 
                    <label for="branchSelect" class="sr-only">Select Branch:</label>
                    <select id="branchSelect">
                        <option value="">Loading branches...</option>
                    </select>
                </div>
                <!-- Removed old status/refresh elements -->
            </div>
        </div>
        
        <div class="room-input-container">
            <label for="roomNumber">Room Number:</label>
            <input type="text" id="roomNumber" placeholder="Enter room number (e.g. 101)" required>
        </div>
        
        <div class="audit-content">
            <div class="checklist-container">
                <div class="checklist-header">
                    <h2>Room Inspection Checklist</h2>
                </div>
                <div class="checklist-items">
                    <div class="checklist-item">
                        <div class="checkbox-wrapper">
                            <input type="checkbox" id="lights" name="lights">
                            <span class="checkbox-custom"></span>
                        </div>
                        <label for="lights">Lights</label>
                    </div>
                    <div class="checklist-item">
                        <div class="checkbox-wrapper">
                            <input type="checkbox" id="switches" name="switches">
                            <span class="checkbox-custom"></span>
                        </div>
                        <label for="switches">Switches</label>
                    </div>
                    <div class="checklist-item">
                        <div class="checkbox-wrapper">
                            <input type="checkbox" id="powerPlugs" name="powerPlugs">
                            <span class="checkbox-custom"></span>
                        </div>
                        <label for="powerPlugs">Power Plugs</label>
                    </div>
                    <div class="checklist-item">
                        <div class="checkbox-wrapper">
                            <input type="checkbox" id="mirrors" name="mirrors">
                            <span class="checkbox-custom"></span>
                        </div>
                        <label for="mirrors">Mirrors</label>
                    </div>
                    <div class="checklist-item">
                        <div class="checkbox-wrapper">
                            <input type="checkbox" id="furniture" name="furniture">
                            <span class="checkbox-custom"></span>
                        </div>
                        <label for="furniture">Furniture</label>
                    </div>
                    <div class="checklist-item">
                        <div class="checkbox-wrapper">
                            <input type="checkbox" id="beerOpeners" name="beerOpeners">
                            <span class="checkbox-custom"></span>
                        </div>
                        <label for="beerOpeners">Beer Openers</label>
                    </div>
                    <div class="checklist-item">
                        <div class="checkbox-wrapper">
                            <input type="checkbox" id="doorViewer" name="doorViewer">
                            <span class="checkbox-custom"></span>
                        </div>
                        <label for="doorViewer">Door Viewer</label>
                    </div>
                    <div class="checklist-item">
                        <div class="checkbox-wrapper">
                            <input type="checkbox" id="doorLocks" name="doorLocks">
                            <span class="checkbox-custom"></span>
                        </div>
                        <label for="doorLocks">Door Locks</label>
                    </div>
                    <div class="checklist-item">
                        <div class="checkbox-wrapper">
                            <input type="checkbox" id="wallDamage" name="wallDamage">
                            <span class="checkbox-custom"></span>
                        </div>
                        <label for="wallDamage">Wall Damage</label>
                    </div>
                    <div class="checklist-item">
                        <div class="checkbox-wrapper">
                            <input type="checkbox" id="mould" name="mould">
                            <span class="checkbox-custom"></span>
                        </div>
                        <label for="mould">Mould</label>
                    </div>
                </div>
            </div>
            
            <div class="notes-container">
                <div class="notes-header">
                    <h2>Additional Notes</h2>
                </div>
                <div class="notes-content">
                    <textarea id="auditNotes" placeholder="Enter any additional details about the room's condition..."></textarea>
                </div>
            </div>
        </div>
        
        <input type="file" id="photoInput" accept="image/*" style="display: none;">
        <div class="image-preview-container" id="imagePreview">
            <img id="previewImage" src="#" alt="Image preview">
        </div>
        
        <div class="action-buttons">
            <button class="action-button upload-button" id="uploadPhotoBtn">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                    <circle cx="8.5" cy="8.5" r="1.5"></circle>
                    <polyline points="21 15 16 10 5 21"></polyline>
                </svg>
                Upload Evidence
            </button>
            <button class="action-button submit-button" id="submitAuditBtn">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="20 6 9 17 4 12"></polyline>
                </svg>
                Submit Audit
            </button>
        </div>
    </div>

    <!-- Add this after the form but before any closing tags -->
    <div id="corsHelpModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 600px; padding: 20px; border-radius: 8px;">
            <div class="modal-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h3 style="margin: 0; color: #3a7bd5;">CORS Issues with Photo Uploads</h3>
                <button id="closeCorsModal" style="background: none; border: none; font-size: 24px; cursor: pointer;">&times;</button>
            </div>
            <div class="modal-body">
                <p><strong>What is happening?</strong></p>
                <p>When you try to upload photos from a development environment (like <code>http://localhost</code> or <code>http://127.0.0.1</code>), browsers enforce a security policy called CORS (Cross-Origin Resource Sharing) that prevents your local website from uploading files to Firebase Storage.</p>
                
                <p><strong>How does this affect me?</strong></p>
                <p>You can still use all features of the application except for photo uploads. Your audits will be saved without photos.</p>
                
                <p><strong>Solutions for developers:</strong></p>
                <ol>
                    <li>
                        <strong>Configure CORS in Firebase Storage:</strong>
                        <pre style="background: #f5f5f5; padding: 10px; border-radius: 4px; overflow-x: auto;">
# Install gsutil (part of Google Cloud SDK)
gsutil cors set cors-config.json gs://your-firebase-bucket

# Example cors-config.json:
[
  {
    "origin": ["http://localhost:5000", "http://127.0.0.1:5500"],
    "method": ["GET", "POST", "PUT", "DELETE"],
    "maxAgeSeconds": 3600
  }
]</pre>
                    </li>
                    <li>
                        <strong>Deploy to Firebase Hosting:</strong>
                        <p>When the app is deployed to Firebase Hosting, CORS issues disappear because the app and storage are on the same domain.</p>
                    </li>
                    <li>
                        <strong>Use Firebase Emulators:</strong>
                        <p>For local development, Firebase provides emulators that avoid CORS issues.</p>
                    </li>
                </ol>
                
                <p><strong>What to do now:</strong></p>
                <p>Continue using the application without photo uploads. All other functions work normally, and your audit data will be saved correctly.</p>
                
                <div style="background-color: #f0f9ff; border-left: 4px solid #3a7bd5; padding: 10px; margin: 15px 0; border-radius: 4px;">
                    <p><strong>Simple Workaround:</strong> Instead of uploading photos, you can describe the issues in detail in the "Audit Notes" section. For example:</p>
                    <p style="font-style: italic; font-size: 0.9rem; margin-bottom: 0;">
                        "Door lock is loose at hinges, approx. 2mm gap visible. See photos sent separately via email to maintenance@example.com"
                    </p>
                </div>
                
                <div style="margin-top: 20px; display: flex; justify-content: flex-end;">
                    <button id="understandCorsBtn" style="background: #3a7bd5; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer;">I Understand</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize loading indicator
            const loadingContainer = document.getElementById('loadingContainer');
            
            // Photo upload functionality
            const uploadPhotoBtn = document.getElementById('uploadPhotoBtn');
            const photoInput = document.getElementById('photoInput');
            const imagePreview = document.getElementById('imagePreview');
            const previewImage = document.getElementById('previewImage');
            
            // Branch selection elements
            const branchNameElement = document.getElementById('branchNameDisplay');
            const branchSelect = document.getElementById('branchSelect');
            
            // Populate branch dropdown and load current branch information
            async function initializeBranchSelector() {
                try {
                    // Show loading while initializing
                    loadingContainer.classList.add('active');
                    
                    // Make sure hotel branch manager is available
                    if (!window.hotelBranchManager) {
                        throw new Error('Branch manager not available');
                    }
                    
                    // Get all branches
                    const branches = await window.hotelBranchManager.getAllBranches();
                    
                    if (!branches || branches.length === 0) {
                        // No branches available
                        const option = document.createElement('option');
                        option.value = '';
                        option.textContent = 'No branches available';
                        branchSelect.appendChild(option);
                        
                        branchNameElement.textContent = 'No Branches Available';
                    } else {
                        // Get current branch
                        const currentBranchId = window.hotelBranchManager.getCurrentBranch();
                        
                        // Clear dropdown
                        branchSelect.innerHTML = '';
                        
                        // Add default option
                        const defaultOption = document.createElement('option');
                        defaultOption.value = '';
                        defaultOption.textContent = '-- Select a branch --';
                        branchSelect.appendChild(defaultOption);
                        
                        // Find the current branch in the branches array
                        const currentBranch = currentBranchId ? branches.find(branch => branch.id === currentBranchId) : null;
                        
                        // Add all branches to dropdown
                        branches.forEach(branch => {
                            const option = document.createElement('option');
                            option.value = branch.id;
                            option.textContent = branch.name;
                            
                            // Select current branch if exists
                            if (currentBranchId && branch.id === currentBranchId) {
                                option.selected = true;
                                
                                // Update branch display using the data from the getAllBranches() result
                                branchNameElement.textContent = branch.name;
                            }
                            
                            branchSelect.appendChild(option);
                        });
                        
                        // If no branch is selected but branches exist
                        if (!currentBranchId && branches.length > 0) {
                            branchNameElement.textContent = 'No Branch Selected';
                        }
                    }
                    
                    // Hide loading indicator
                    loadingContainer.classList.remove('active');
                    
                    // Initialize Choices.js
                    if (window.choicesInstance) {
                        window.choicesInstance.destroy();
                    }
                    window.choicesInstance = new Choices(branchSelect, {
                        searchEnabled: true,
                        itemSelectText: '', // Remove 'Press to select' text
                        shouldSort: false, // Keep original order
                        allowHTML: false,
                    });

                } catch (error) {
                    console.error('Error initializing branch selector:', error);
                    
                    // Show error in dropdown
                    branchSelect.innerHTML = '';
                    const errorOption = document.createElement('option');
                    errorOption.value = '';
                    errorOption.textContent = 'Error loading branches';
                    branchSelect.appendChild(errorOption);
                    
                    branchNameElement.textContent = 'Error Loading Branches';
                    loadingContainer.classList.remove('active');
                }
            }
            
            // Handle branch selection change (using Choices.js event)
            branchSelect.addEventListener('change', async function(event) { // Listen to the original select's change event
                try {
                    const selectedBranchId = event.detail.value; // Get value from Choices.js event detail
                    
                    if (!selectedBranchId) {
                        branchNameElement.textContent = 'No Branch Selected';
                        return;
                    }
                    
                    // Show loading indicator
                    loadingContainer.classList.add('active');
                    
                    // Get branch name (might need adjustment if Choices.js changes the structure)
                    // Assuming the text content is still available on the original select's chosen option
                    const selectedOption = Array.from(branchSelect.options).find(opt => opt.value === selectedBranchId);
                    const branchName = selectedOption ? selectedOption.textContent : 'Selected Branch';

                    // Set the current branch using the correct method
                    await window.hotelBranchManager.loadBranchData(selectedBranchId);
                    
                    // Get all branches to find the one we just selected
                    const branches = await window.hotelBranchManager.getAllBranches();
                    const selectedBranch = branches.find(branch => branch.id === selectedBranchId);
                    
                    if (selectedBranch) {
                        // Update branch display with data we have
                        branchNameElement.textContent = selectedBranch.name || branchName;
                    } else {
                        // We have no branch details, but we know the branch was loaded successfully
                        branchNameElement.textContent = branchName;
                    }
                      
                    // Hide loading indicator
                    loadingContainer.classList.remove('active');

                    // Optional: Reload page if needed for other components to update based on branch change
                    // window.location.reload(); 

                } catch (error) {
                    console.error('Error selecting branch:', error);
                    branchNameElement.textContent = 'Error Selecting Branch';
                    loadingContainer.classList.remove('active');
                }
            });
            
            // Initialize branch selector
            initializeBranchSelector();
            
            // Listen for localStorage changes (in case the branch is changed in another tab)
            window.addEventListener('storage', function(e) {
                if (e.key === 'selectedBranch') {
                    // Reload the page to get fresh branch data
                    window.location.reload();
                }
            });
            
            uploadPhotoBtn.addEventListener('click', function() {
                photoInput.click();
            });
            
            photoInput.addEventListener('change', function(event) {
                if (event.target.files && event.target.files[0]) {
                    const reader = new FileReader();
                    
                    reader.onload = function(e) {
                        previewImage.src = e.target.result;
                        imagePreview.style.display = 'block';
                    };
                    
                    reader.readAsDataURL(event.target.files[0]);
                }
            });
            
            // Submit audit functionality will be implemented in room-audit.js
        });

        // Function to show the CORS help modal
        function showCorsHelpModal() {
            const modal = document.getElementById('corsHelpModal');
            modal.style.display = 'flex';
            setTimeout(() => {
                modal.classList.add('show');
            }, 10);
        }
        
        // Set up event listeners after DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Close button handler
            const closeBtn = document.getElementById('closeCorsModal');
            if (closeBtn) {
                closeBtn.addEventListener('click', function() {
                    const modal = document.getElementById('corsHelpModal');
                    modal.classList.remove('show');
                    setTimeout(() => {
                        modal.style.display = 'none';
                    }, 300);
                });
            }
            
            // Understand button handler
            const understandBtn = document.getElementById('understandCorsBtn');
            if (understandBtn) {
                understandBtn.addEventListener('click', function() {
                    const modal = document.getElementById('corsHelpModal');
                    modal.classList.remove('show');
                    setTimeout(() => {
                        modal.style.display = 'none';
                    }, 300);
                });
            }
            
            // Add a help link near the photo upload field
            // Find the photo input container without using :has selector
            const photoInput = document.getElementById('photoInput');
            if (photoInput) {
                const photoInputContainer = photoInput.closest('.form-group');
                if (photoInputContainer) {
                    const helpLink = document.createElement('a');
                    helpLink.href = '#';
                    helpLink.textContent = 'Having trouble uploading photos?';
                    helpLink.style.fontSize = '0.8rem';
                    helpLink.style.marginTop = '5px';
                    helpLink.style.display = 'inline-block';
                    helpLink.style.color = '#3a7bd5';
                    
                    helpLink.addEventListener('click', function(e) {
                        e.preventDefault();
                        showCorsHelpModal();
                    });
                    
                    photoInputContainer.appendChild(helpLink);
                }
            }
        });
    </script>

    <!-- Choices.js JS -->
    <script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>
</body>
</html> 